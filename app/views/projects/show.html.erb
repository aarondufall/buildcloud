<h3><%= @project.name %></h3>


<div class="project-nav">
<ul class="nav nav-tabs ">
  <li><%= link_to 'To-dos', project_todolists_path(@project) %></li>
  <li><%= link_to 'Waiting', '#' %></li>
  <li><%= link_to 'R.F.I.', '#' %></li>
  <li><%= link_to 'Files', '#' %></li>
  <li><%= link_to 'Dates', '#' %></li>
</ul>
</div>

<ul class="navlist">
<li>To-do Lists</li>

<li><%= link_to 'Add to-do list', new_project_todolist_path(@project), :class => 'btn btn-mini'%></li>
</ul>

<% @todolists.each do |todolist| %>
<table class="table table-bordered table-condensed">
  <thead>
    <tr>
    	<th>
        <%= todolist.name %> 
        <div class='pull-right'>
          Completed  <span class="badge"><%= todolist.todos.completed.count %></span>
        <% if todolist.start_date? %>
              Start:<span class="date"> <%= l todolist.start_date %> </span>
              Duration:
              <span class="date"> 
                <%= distance_of_time_in_words(todolist.start_date, todolist.end_date) %>
              </span>
        <% else %>
          Due date:<span class="date"> <%= todolist.end_date %></span>
        <% end %>
          <%= link_to [:edit, @project, todolist], :class => 'btn btn-mini',
                                                   :method => 'get' do %>
            <i class="icon-pencil icon-white"></i> Edit
          <% end %>

       </div>   
      </th>
     </tr>
  </thead>
  <tbody>
        <% if todolist.todos.count <= 0 %>
        <tr>
          <td>
          Let's get started and add some tasks to the list
        </td>
        </tr>
        <% else %>
        <% todolist.todos.each do |todo| %>

        <% unless todo.completed_at? %>
          <tr>
            <td>
              <%= todo.name %><%= todo.completed_at %>
                <%= link_to [:edit, @project, todolist, todo], :class => 'btn btn-mini pull-right btn-gap',
                                                       :method => 'get' do %>
                  <i class="icon-pencil icon-white"></i> Edit
                <% end %>
              
                <div class="btn-group pull-right">
                  <a class="btn btn-warning btn-mini btn-gap dropdown-toggle" data-toggle="dropdown" href="#">
                    Waiting
                    <span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu">
                    <li><a href='#'>R.F.I</a></li>
                    <li><a href='#'>Rectification</a></li>
                    <li><a href='#'>Completion of works</a></li>
                  </ul>
                </div>
            
                <%= link_to [@project, todolist, todo, :complete_todo], :class => 'btn btn-mini btn-success pull-right btn-gap', :method => 'put' do %>
                  <i class="icon-ok icon-white"></i> Done
                <% end %>

                <% unless todo.assigned_to == nil  %>
                  <span class="label label-info btn-gap pull-right"><%= todo.assigned_to.profile.name %></span>
                <% else %>
                    <span class="label label-info btn-gap pull-right">Unassigned</span>
                <% end %> 
            </td>
          </tr>
        
          <% end %>
      <% end %>
      <% end %>
  </tbody>
</table>
<%= link_to 'Add todo', [:new, @project, todolist, :todo], :class => 'btn btn-mini' %>
<br />
<br />                                              
<% end %>